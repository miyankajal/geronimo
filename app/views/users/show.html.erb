<h2>Welcome! <%= current_user.first_name %> <%= current_user.last_name %></h2>

<hr>
<div class="col-md-3">

<%= gravatar_for(@user) %>
</div>

<div class="col-md-9">

	<p>
		<strong>Full name:</strong>
		<%= @user.first_name %> <%= @user.last_name %>
	</p>
	
	<p>
	  <strong>Username:</strong>
	  <%= @user.username %>
	</p>

	<p>
	  <strong>Email:</strong>
	  <%= @user.email %>
	</p>

	<% if @user.type == 3 %>
		<p>
		  <strong>Enrollment:</strong>
		  <%= @user.enrollment_id %>
		</p>

		<p>
		  <strong>Class:</strong>
		  <%= @user_grade %>
		</p>

		</br>
		<% if current_user.type != 1 %>
			<div class="span8">
				<% if @student_points_desc.any? %>	
					<h3>Total Points: <%= @total_points %></h3>
					<hr>
					<ol class="list-unstyled">
					<% @student_points_desc.each do |point| %>
						<%= render point %>
						<hr>
					<% end %>
					</ol>
				<% end %>
			</div>
		<% end %>
	
		<p>
			<% if current_user.type == 2 && class_teacher?(current_user.id, @user.class_id)%>
				<%= link_to 'Add Points', new_student_point_path(:user_id => @user.id) %>
			<% end %>
		</p>
		<p>	
			<%= link_to 'Generate Report', user_report_path(:user_id => @user.id) %>
		</p>
	<% end %>
	
	<p>
		<% if current_user.type == 1 %>
			<%= link_to 'Edit', edit_user_path(@user) %>
		<% end %>
	</p>

	
	<!--if the user is a guardian help them search for their ward-->
	<% if @user.type.to_s == "4" %>
		<hr>
		<h3>Add Ward</h3>
		</br>
		
	   <%= form_tag(users_path, :method => "get", class: "form-search", id: "search-form") do %>
			<div class="input-append">
			  <%= text_field_tag :search, params[:search], class: "span2 search-query", placeholder: "Search Users" %>
			  <%= hidden_field_tag 'guardian_id', @user.id %>
			  <!-- In order to have the "search" icon int the button, we need to use plain HTML instead 
				   of using a Rails form helper -->
			  <button class="btn-small btn-primary" type="submit">Search</button>
			</div>
	  <% end %>
	  <%= yield %>
	  
	  </br>
	  <% @wards = get_wards(@user.id) %>
	  <% if @wards.any? %>
		   <table class="table table-striped table-hover">
			<thead>
			<tr>
			  <th>Enrollment ID</th>
			  <th>Username</th>
			  <th>Name</th>
			  <th>Action</th>
			</tr>
			</thead>
			<tbody>
			<% @wards.each do |user| %>
				<%= render user, type: params[:type] %>
			<% end %>
			</tbody>
		   </table>
	   <% end %>
	<% end %>

	
	<% if @user.type == 2 %>
		 <% if @teacher_class.any? %>
			 <table class="table table-striped table-hover">
			  <thead>
				<tr>
				  <th>Classes</th>
				  <th>Teacher Role</th>
				  <th>Action</th>
				</tr>
			  </thead>

			  <tbody>
				<% @teacher_class.each do |class_section| %>
				  <tr>
					<td><%= link_to get_teacher_class(class_section.class_section_id), users_path(type: 3, desc: 'Students', class_id: class_section.class_section_id)%></td>
					<td><%= get_teacher_role(class_section.teacher_role_id) %></td>
					<td><%= link_to 'Destroy', class_section, method: :delete, data: { confirm: 'Are you sure?' } %></td>
				  </tr>
				<% end %>
			  </tbody
			 </table>
		 <% end %>
 
		 <p>
			<% if current_user.type == 1 %>
				<%= link_to 'Add Classes', new_teacher_class_relationship_path(:user_id => @user.id) %>
			<% end %>
		 </p>	
	<% end %>
	
	</br>
	</br>
	</br>
	<% if current_user.type == 1 &&  @user.type.to_s == "1" %>
		<div class="span7">
			<div class="row">
				<div class="well" style="width:100%;">
					<div class="alert alert-dismissable alert-success">
					
							As the Administrator of the site, you can edit Users (Teachers, Guardians and Classes > Students). Explore these options in the Users dropdown list in the navigation bar.</br></br>
							To add new users go to the particular user type in the Users menu and click 'New User'. Every user can be edited and destroyed except the Administrators.</br></br>
							The Reports section shows the school reports based on the data accumulated.</br></br>
							The Settings section should be used to define School Terms (semester/yearly), Alert settings for the school term, and the Points pertaining to defined behaviors.</br></br>

					</div>
				</div>
			</div>
		</div>
	<% end %>
</div>
